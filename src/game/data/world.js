import { KNIGHT_ASSET, ROGUE_ASSET, WIZZARD_ASSET } from './constants'

export const MAPS = {
  ashen_meadow: {
    id: 'ashen_meadow',
    name: 'Prairie des Cendres',
    levelRange: '1-3',
    isSecret: false,
    background: '/assets/Environment/Tilesets/Floors_Tiles.png',
    width: 16,
    height: 12,
    start: { x: 1, y: 1 },
    exit: { x: 14, y: 10, targetMapId: 'whispering_catacombs' },
    secretPortal: {
      x: 2,
      y: 10,
      targetMapId: 'lunar_shrine',
      revealChance: 0.22,
    },
    backPortal: null,
    npcs: [
      {
        id: 'npc_cartographer',
        name: 'Iria la Cartographe',
        role: 'lore',
        x: 2,
        y: 2,
        portrait: WIZZARD_ASSET,
        dialogue: 'La Brume ne ment jamais. Chaque éclat révèle une route oubliée.',
        riddlePool: [
          {
            id: 'riddle_ashen_map',
            question: 'Je révèle les routes cachées sans marcher. Qui suis-je ?',
            options: [
              { id: 'wind', text: 'Le vent' },
              { id: 'map', text: 'Une carte' },
              { id: 'moon', text: 'La lune' },
            ],
            correctOptionId: 'map',
            successText: 'Iria te félicite et dévoile un portail cache.',
            failText: 'Iria secoue la tête. La Brume se referme pour cette fois.',
            reward: {
              gold: 40,
              materials: { ether_drop: 1 },
              revealSecretPortal: true,
            },
          },
          {
            id: 'riddle_ashen_echo',
            question: 'Plus tu m\'enlèves, plus je deviens grand. Qui suis-je ?',
            options: [
              { id: 'hole', text: 'Un trou' },
              { id: 'stone', text: 'Une pierre' },
              { id: 'river', text: 'Une rivière' },
            ],
            correctOptionId: 'hole',
            successText: 'Le sol tremble: un souffle secret traverse la prairie.',
            failText: 'Iria marque une croix sur ton carnet. Occasion manquée.',
            reward: {
              gold: 42,
              materials: { resin: 2 },
              revealSecretPortal: true,
            },
          },
          {
            id: 'riddle_ashen_time',
            question: 'Je cours sans jambe, je chante sans bouche. Qui suis-je ?',
            options: [
              { id: 'water', text: 'L\'eau' },
              { id: 'bird', text: 'Un oiseau' },
              { id: 'fire', text: 'Le feu' },
            ],
            correctOptionId: 'water',
            successText: 'Iria t\'offre un mot-clé et le secret s\'ouvre.',
            failText: 'La réponse se dissipe. Le secret ne réagit plus.',
            reward: {
              gold: 45,
              materials: { herb: 2 },
              revealSecretPortal: true,
            },
          },
          {
            id: 'riddle_ashen_key',
            question: 'J\'ouvre ce qui est ferme sans toucher la serrure. Je traverse les murs sans laisser de trace. Qui suis-je ?',
            options: [
              { id: 'key', text: 'Une cle' },
              { id: 'thought', text: 'Une idée' },
              { id: 'light', text: 'La lumière' },
            ],
            correctOptionId: 'thought',
            successText: 'Iria trace un symbole. Un passage secret apparaît.',
            failText: 'Iria range son carnet. Pas cette fois.',
            reward: {
              gold: 44,
              materials: { resin: 1, herb: 1 },
              revealSecretPortal: true,
            },
          },
          {
            id: 'riddle_ashen_beginning',
            question: 'Mon commencement est la fin de tout. Mon milieu montre le chemin. Qui suis-je ?',
            options: [
              { id: 'death', text: 'La mort' },
              { id: 'letter_e', text: 'La lettre E' },
              { id: 'road', text: 'La route' },
            ],
            correctOptionId: 'letter_e',
            successText: 'Iria décode le message. La Brume recule.',
            failText: 'Le symbole ne répond pas.',
            reward: {
              gold: 46,
              materials: { ether_drop: 1 },
              revealSecretPortal: true,
            },
          },
          {
            id: 'riddle_ashen_silence',
            question: 'Plus tu me cherches, moins tu me trouves. Dès que tu m\'oublies, je reviens. Qui suis-je ?',
            options: [
              { id: 'silence', text: 'Le silence' },
              { id: 'sleep', text: 'Le sommeil' },
              { id: 'shadow', text: 'L\'ombre' },
            ],
            correctOptionId: 'silence',
            successText: 'Un murmure traverse la prairie. Le portail s\'éclaircit.',
            failText: 'Iria secoue la tête. La Brume se referme.',
            reward: {
              gold: 43,
              materials: { herb: 2 },
              revealSecretPortal: true,
            },
          },
          {
            id: 'riddle_ashen_rich',
            question: 'Plus on me partage, plus on m accumule. Plus on me garde, plus on me perd. Qui suis-je ?',
            options: [
              { id: 'gold', text: 'L or' },
              { id: 'knowledge', text: 'Le savoir' },
              { id: 'love', text: 'L\'amour' },
            ],
            correctOptionId: 'knowledge',
            successText: 'Iria te confie un fragment de carte. Le passage se dévoile.',
            failText: 'La cartographe referme son livre.',
            reward: {
              gold: 47,
              materials: { resin: 2 },
              revealSecretPortal: true,
            },
          },
          {
            id: 'riddle_ashen_forward',
            question: 'Je peux être casse sans avoir été tenu. Donne et recu en un meme instant. Qui suis-je ?',
            options: [
              { id: 'promise', text: 'Une promesse' },
              { id: 'egg', text: 'Un oeuf' },
              { id: 'silence_riddle', text: 'Le silence' },
            ],
            correctOptionId: 'promise',
            successText: 'Iria valide ta réponse. Un portail fremit dans la Brume.',
            failText: 'Le chemin reste cache.',
            reward: {
              gold: 45,
              materials: { herb: 1, resin: 1 },
              revealSecretPortal: true,
            },
          },
          {
            id: 'riddle_ashen_breath',
            question: 'Je n\'ai pas de corps mais je réveille les flammes. Je n\'ai pas de voix mais j\'emporte les mots. Qui suis-je ?',
            options: [
              { id: 'wind', text: 'Le vent' },
              { id: 'spirit', text: 'Un esprit' },
              { id: 'dream', text: 'Le reve' },
            ],
            correctOptionId: 'wind',
            successText: 'La Brume ondule. Iria pointe un passage secret.',
            failText: 'Rien ne bouge. Occasion perdue.',
            reward: {
              gold: 44,
              materials: { ether_drop: 1 },
              revealSecretPortal: true,
            },
          },
          {
            id: 'riddle_ashen_end',
            question: 'Je suis le debut de la fin et la fin de tout lieu. On me trouve au milieu de chaque jour. Qui suis-je ?',
            options: [
              { id: 'letter_e', text: 'La lettre E' },
              { id: 'death', text: 'La mort' },
              { id: 'night', text: 'La nuit' },
            ],
            correctOptionId: 'letter_e',
            successText: 'Iria sourit. Le portail cache s\'ouvre.',
            failText: 'La cartographe ne réagit pas.',
            reward: {
              gold: 46,
              materials: { herb: 2 },
              revealSecretPortal: true,
            },
          },
        ],
      },
      {
        id: 'npc_woodsmith',
        name: 'Bram le Scieur',
        role: 'craft',
        x: 5,
        y: 9,
        portrait: KNIGHT_ASSET,
        dialogue: 'Bois, minerai, os. Je fabrique ce que tu sais payer ou recolter.',
      },
      {
        id: 'npc_mender',
        name: 'Sera la Soin-lame',
        role: 'healer',
        x: 9,
        y: 2,
        portrait: ROGUE_ASSET,
        dialogue: 'Je referme tes plaies, mais pas gratuitement.',
      },
    ],
    resources: [
      { id: 'ash_tree_1', type: 'tree', x: 4, y: 3, charges: 3 },
      { id: 'ash_tree_2', type: 'tree', x: 6, y: 6, charges: 3 },
      { id: 'ash_ore_1', type: 'ore', x: 12, y: 4, charges: 2 },
      { id: 'ash_ore_2', type: 'ore', x: 11, y: 8, charges: 2 },
      { id: 'ash_herb_1', type: 'herb', x: 7, y: 3, charges: 3 },
      { id: 'ash_herb_2', type: 'herb', x: 13, y: 5, charges: 3 },
    ],
    chests: [
      { id: 'chest_ash_1', x: 10, y: 9, rarityBias: 'rare' },
      { id: 'chest_ash_2', x: 3, y: 8, rarityBias: 'uncommon' },
    ],
    enemies: [
      { id: 'e_ash_1', templateId: 'ash_hound', x: 10, y: 3 },
      { id: 'e_ash_2', templateId: 'ash_hound', x: 12, y: 7 },
      { id: 'e_ash_3', templateId: 'shrouded_orc', x: 8, y: 8 },
      { id: 'e_ash_4', templateId: 'shrouded_orc', x: 4, y: 6 },
    ],
    boss: { id: 'boss_ash', templateId: 'boss_ash_colossus', x: 13, y: 2 },
    tiles: [
      '################',
      '#..............#',
      '#..~~...##.....#',
      '#......###.....#',
      '#......#.......#',
      '#......#..~~...#',
      '#..........#...#',
      '#..###.....#...#',
      '#..#.......#...#',
      '#..#...........#',
      '#..............#',
      '################',
    ],
  },

  whispering_catacombs: {
    id: 'whispering_catacombs',
    name: 'Catacombes Murmurantes',
    levelRange: '4-6',
    isSecret: false,
    background: '/assets/Environment/Tilesets/Wall_Tiles.png',
    width: 16,
    height: 12,
    start: { x: 1, y: 10 },
    exit: { x: 14, y: 1, targetMapId: 'obsidian_citadel' },
    secretPortal: {
      x: 8,
      y: 10,
      targetMapId: 'forgotten_foundry',
      revealChance: 0.28,
    },
    backPortal: {
      x: 1,
      y: 1,
      targetMapId: 'ashen_meadow',
    },
    npcs: [
      {
        id: 'npc_broker',
        name: 'Nell le Courtier',
        role: 'merchant',
        x: 2,
        y: 9,
        portrait: ROGUE_ASSET,
        dialogue: 'Besoin de ravitaillement ? Tu es au bon endroit.',
      },
      {
        id: 'npc_keeper',
        name: 'Gardien Yorn',
        role: 'lore',
        x: 10,
        y: 8,
        portrait: KNIGHT_ASSET,
        dialogue: 'Le Roi des Os garde la sortie. Sans sa chute, personne ne passe.',
        riddlePool: [
          {
            id: 'riddle_cat_fire',
            question: 'Plus je mange, plus je grandis. Si je bois, je meurs. Qui suis-je ?',
            options: [
              { id: 'fire', text: 'Le feu' },
              { id: 'wolf', text: 'Un loup' },
              { id: 'stone', text: 'Une pierre' },
            ],
            correctOptionId: 'fire',
            successText: 'Yorn t\'accorde son sceau et dévoile un passage cache.',
            failText: 'Yorn referme son heaume. C est rate pour cette expedition.',
            reward: {
              gold: 70,
              materials: { boss_shard: 1 },
              revealSecretPortal: true,
            },
          },
          {
            id: 'riddle_cat_shadow',
            question: 'Je te suis partout, mais disparais dans le noir. Qui suis-je ?',
            options: [
              { id: 'shadow', text: 'Ton ombre' },
              { id: 'fear', text: 'La peur' },
              { id: 'dust', text: 'La poussiere' },
            ],
            correctOptionId: 'shadow',
            successText: 'Yorn te juge digne. Le mecanisme des catacombes s\'active.',
            failText: 'Le Gardien reste silencieux. Aucun second essai.',
            reward: {
              gold: 66,
              materials: { bone_dust: 2 },
              revealSecretPortal: true,
            },
          },
          {
            id: 'riddle_cat_king',
            question: 'Le Roi des Os commande sans parole. Il regne sur des sujets qui ne bougent plus. Qui est-il vraiment ?',
            options: [
              { id: 'death', text: 'La mort' },
              { id: 'skeleton', text: 'Un squelette' },
              { id: 'time', text: 'Le temps' },
            ],
            correctOptionId: 'death',
            successText: 'Yorn incline son heaume. Le passage secret grince ouvert.',
            failText: 'Le Gardien ne bouge pas. Une seule chance.',
            reward: {
              gold: 72,
              materials: { bone_dust: 2 },
              revealSecretPortal: true,
            },
          },
          {
            id: 'riddle_cat_whisper',
            question: 'Dans ces murs on m\'entend sans que personne ne parle. Je grandis quand on m\'ignore. Qui suis-je ?',
            options: [
              { id: 'echo', text: 'L echo' },
              { id: 'rumor', text: 'La rumeur' },
              { id: 'silence', text: 'Le silence' },
            ],
            correctOptionId: 'rumor',
            successText: 'Yorn frappe le sol. Une trappe cachée s\'ouvre.',
            failText: 'Les catacombes gardent leur secret.',
            reward: {
              gold: 68,
              materials: { boss_shard: 1 },
              revealSecretPortal: true,
            },
          },
          {
            id: 'riddle_cat_key',
            question: 'Je n\'ouvre qu\'une seule porte, mais cette porte ne se ferme plus jamais. Qui suis-je ?',
            options: [
              { id: 'key', text: 'Une cle' },
              { id: 'word', text: 'Un mot' },
              { id: 'death', text: 'La mort' },
            ],
            correctOptionId: 'death',
            successText: 'Yorn valide. Le mecanisme ancestral se déclenche.',
            failText: 'Le Gardien referme son heaume.',
            reward: {
              gold: 70,
              materials: { bone_dust: 3 },
              revealSecretPortal: true,
            },
          },
          {
            id: 'riddle_cat_bridge',
            question: 'Je relie deux rives sans toucher l\'eau. Je disparais dès que tu m\'as traverse. Qui suis-je ?',
            options: [
              { id: 'bridge', text: 'Un pont' },
              { id: 'memory', text: 'Un souvenir' },
              { id: 'breath', text: 'Le souffle' },
            ],
            correctOptionId: 'memory',
            successText: 'Yorn te fait signe. Un passage se dévoile dans la pierre.',
            failText: 'Rien ne s\'ouvre. Tentative épuisée.',
            reward: {
              gold: 69,
              materials: { ether_drop: 1 },
              revealSecretPortal: true,
            },
          },
          {
            id: 'riddle_cat_light',
            question: 'Plus la lumiere m\'éclaire, plus mon pouvoir faiblit. Dans l\'obscurité je deviens maître. Qui suis-je ?',
            options: [
              { id: 'shadow', text: 'L\'ombre' },
              { id: 'night', text: 'La nuit' },
              { id: 'fear', text: 'La peur' },
            ],
            correctOptionId: 'shadow',
            successText: 'Le Gardien trace un rune. Le portail secret fremit.',
            failText: 'Yorn ne réagit pas. Plus d\'essai.',
            reward: {
              gold: 71,
              materials: { boss_shard: 1 },
              revealSecretPortal: true,
            },
          },
          {
            id: 'riddle_cat_guest',
            question: 'J entre sans frapper. Je repars sans avoir bouge. Tout le monde me recoit une fois. Qui suis-je ?',
            options: [
              { id: 'thief', text: 'Un voleur' },
              { id: 'dream', text: 'Le reve' },
              { id: 'death', text: 'La mort' },
            ],
            correctOptionId: 'death',
            successText: 'Yorn approuve. Les catacombes livrent un passage cache.',
            failText: 'Le sceau reste intact.',
            reward: {
              gold: 67,
              materials: { bone_dust: 2 },
              revealSecretPortal: true,
            },
          },
          {
            id: 'riddle_cat_chain',
            question: 'Chaque maillon me renforce. Chaque rupture me détruit. Je lie le Roi à son royaume. Qui suis-je ?',
            options: [
              { id: 'chain', text: 'Une chaîne' },
              { id: 'oath', text: 'Le serment' },
              { id: 'time', text: 'Le temps' },
            ],
            correctOptionId: 'oath',
            successText: 'Yorn baisse sa garde. Le passage interdit s\'ouvre.',
            failText: 'Le Gardien reste de pierre.',
            reward: {
              gold: 73,
              materials: { bone_dust: 2, ether_drop: 1 },
              revealSecretPortal: true,
            },
          },
          {
            id: 'riddle_cat_mirror',
            question: 'Je montre ton visage mais je ne suis pas toi. Je repete tout sauf le silence. Qui suis-je ?',
            options: [
              { id: 'mirror', text: 'Un miroir' },
              { id: 'echo', text: 'L echo' },
              { id: 'water', text: 'L\'eau' },
            ],
            correctOptionId: 'echo',
            successText: 'Les murs murmurent. Yorn dévoile l\'accès secret.',
            failText: 'Aucune seconde chance.',
            reward: {
              gold: 68,
              materials: { boss_shard: 1 },
              revealSecretPortal: true,
            },
          },
          {
            id: 'riddle_cat_crown',
            question: 'On me porte sans me toucher. On me perd en me gagnant. Le Roi en a un que personne ne voit. Qui suis-je ?',
            options: [
              { id: 'crown', text: 'Une couronne' },
              { id: 'burden', text: 'Le fardeau' },
              { id: 'honor', text: 'L honneur' },
            ],
            correctOptionId: 'burden',
            successText: 'Yorn te juge digne. Le passage cache grince ouvert.',
            failText: 'Le Gardien ne dit rien. C est rate.',
            reward: {
              gold: 70,
              materials: { bone_dust: 2 },
              revealSecretPortal: true,
            },
          },
        ],
      },
      {
        id: 'npc_anvil',
        name: 'Anvil Nox',
        role: 'craft',
        x: 5,
        y: 2,
        portrait: WIZZARD_ASSET,
        dialogue: 'La forge ancestrale réagit aux os charges de mana.',
      },
    ],
    resources: [
      { id: 'catacomb_ore_1', type: 'ore', x: 4, y: 4, charges: 3 },
      { id: 'catacomb_ore_2', type: 'ore', x: 11, y: 4, charges: 3 },
      { id: 'catacomb_herb_1', type: 'herb', x: 6, y: 8, charges: 2 },
      { id: 'catacomb_tree_1', type: 'tree', x: 13, y: 8, charges: 2 },
    ],
    chests: [
      { id: 'chest_cat_1', x: 8, y: 4, rarityBias: 'epic' },
      { id: 'chest_cat_2', x: 2, y: 7, rarityBias: 'rare' },
    ],
    enemies: [
      { id: 'e_cat_1', templateId: 'bone_guard', x: 4, y: 6 },
      { id: 'e_cat_2', templateId: 'crypt_mage', x: 6, y: 4 },
      { id: 'e_cat_3', templateId: 'whisper_thief', x: 9, y: 5 },
      { id: 'e_cat_4', templateId: 'bone_guard', x: 12, y: 7 },
      { id: 'e_cat_5', templateId: 'crypt_mage', x: 13, y: 3 },
    ],
    boss: { id: 'boss_bone', templateId: 'boss_bone_emperor', x: 14, y: 8 },
    tiles: [
      '################',
      '#.......#......#',
      '#.#####.#.####.#',
      '#.#...#.#....#.#',
      '#.#.#.#.####.#.#',
      '#...#.#....#.#.#',
      '###.#.####.#.#.#',
      '#...#......#...#',
      '#.##########.#.#',
      '#............#.#',
      '#..............#',
      '################',
    ],
  },

  obsidian_citadel: {
    id: 'obsidian_citadel',
    name: 'Citadelle d Obsidienne',
    levelRange: '6-8',
    isSecret: false,
    background: '/assets/Environment/Tilesets/Dungeon_Tiles.png',
    width: 16,
    height: 12,
    start: { x: 1, y: 1 },
    exit: { x: 14, y: 10, targetMapId: 'shattered_sanctum' },
    secretPortal: {
      x: 1,
      y: 10,
      targetMapId: 'lunar_shrine',
      revealChance: 0.36,
    },
    backPortal: {
      x: 14,
      y: 1,
      targetMapId: 'whispering_catacombs',
    },
    npcs: [
      {
        id: 'npc_bard',
        name: 'Luthe le Barde borgne',
        role: 'merchant',
        x: 2,
        y: 9,
        portrait: ROGUE_ASSET,
        dialogue: 'Derniere ligne droite. Fais le plein avant les grands halls.',
      },
      {
        id: 'npc_smith_prime',
        name: 'Maitre Baldur',
        role: 'craft',
        x: 7,
        y: 2,
        portrait: KNIGHT_ASSET,
        dialogue: 'Ici, meme les reliques demandent des ajustements.',
      },
    ],
    resources: [
      { id: 'obs_ore_1', type: 'ore', x: 5, y: 3, charges: 3 },
      { id: 'obs_ore_2', type: 'ore', x: 11, y: 3, charges: 3 },
      { id: 'obs_tree_1', type: 'tree', x: 4, y: 9, charges: 2 },
      { id: 'obs_herb_1', type: 'herb', x: 12, y: 8, charges: 2 },
    ],
    chests: [
      { id: 'chest_obs_1', x: 9, y: 7, rarityBias: 'legendary' },
      { id: 'chest_obs_2', x: 2, y: 4, rarityBias: 'epic' },
    ],
    enemies: [
      { id: 'e_obs_1', templateId: 'obsidian_reaper', x: 6, y: 5 },
      { id: 'e_obs_2', templateId: 'obsidian_reaper', x: 10, y: 5 },
      { id: 'e_obs_3', templateId: 'whisper_thief', x: 8, y: 8 },
      { id: 'e_obs_4', templateId: 'crypt_mage', x: 13, y: 4 },
      { id: 'e_obs_5', templateId: 'bone_guard', x: 3, y: 6 },
    ],
    boss: { id: 'boss_archon', templateId: 'boss_obsidian_archon', x: 14, y: 2 },
    tiles: [
      '################',
      '#......#.......#',
      '#.####.#.#####.#',
      '#.#....#.....#.#',
      '#.#.#######.#..#',
      '#.#.......#.#..#',
      '#.#######.#.##.#',
      '#.......#.#....#',
      '#.#####.#.####.#',
      '#.....#.#......#',
      '#..............#',
      '################',
    ],
  },

  shattered_sanctum: {
    id: 'shattered_sanctum',
    name: 'Sanctuaire Brise',
    levelRange: '8-10',
    isSecret: false,
    background: '/assets/Environment/Tilesets/Wall_Variations.png',
    width: 16,
    height: 12,
    start: { x: 1, y: 10 },
    exit: { x: 14, y: 1, targetMapId: 'abyssal_archive' },
    secretPortal: {
      x: 8,
      y: 1,
      targetMapId: 'echoing_vault',
      revealChance: 0.18,
    },
    backPortal: {
      x: 1,
      y: 1,
      targetMapId: 'obsidian_citadel',
    },
    npcs: [
      {
        id: 'npc_quartermaster',
        name: 'Rovan le Logisticien',
        role: 'merchant',
        x: 2,
        y: 9,
        portrait: KNIGHT_ASSET,
        dialogue: 'Les combats ici sont longs. Prends des utilitaires, pas seulement des soins.',
      },
      {
        id: 'npc_sphinx',
        name: 'Myra la Sphinx',
        role: 'lore',
        x: 9,
        y: 3,
        portrait: WIZZARD_ASSET,
        dialogue: 'Je garde un passage interdit. Une seule tentative, pas plus.',
        riddlePool: [
          {
            id: 'riddle_sanctum_keys',
            question: 'J\'ai des villes mais pas de maisons, des forêts mais pas d\'arbres. Qui suis-je ?',
            options: [
              { id: 'map', text: 'Une carte' },
              { id: 'book', text: 'Un livre' },
              { id: 'clock', text: 'Une horloge' },
            ],
            correctOptionId: 'map',
            successText: 'Myra trace un cercle. Un portail secret apparaît dans le sanctuaire.',
            failText: 'La Sphinx refuse. Le passage reste ferme pour cette run.',
            reward: {
              gold: 95,
              materials: { ether_drop: 2 },
              revealSecretPortal: true,
            },
          },
          {
            id: 'riddle_sanctum_eyes',
            question: 'Je parle sans bouche et j\'entends sans oreilles. Qui suis-je ?',
            options: [
              { id: 'echo', text: 'Un echo' },
              { id: 'drum', text: 'Un tambour' },
              { id: 'blade', text: 'Une lame' },
            ],
            correctOptionId: 'echo',
            successText: 'Le sanctuaire répond à ta voix. Une faille cachée s\'ouvre.',
            failText: 'Myra détourne le regard. Plus aucune tentative aujourd\'hui.',
            reward: {
              gold: 90,
              materials: { boss_shard: 1 },
              revealSecretPortal: true,
            },
          },
          {
            id: 'riddle_sanctum_three',
            question: 'J\'ai quatre pattes le matin, deux à midi, trois le soir. Qui suis-je ?',
            options: [
              { id: 'man', text: 'L homme' },
              { id: 'sun', text: 'Le soleil' },
              { id: 'sphinx', text: 'La Sphinx' },
            ],
            correctOptionId: 'man',
            successText: 'Myra trace un cercle. Le portail secret apparaît.',
            failText: 'La Sphinx refuse. Le passage reste ferme.',
            reward: {
              gold: 92,
              materials: { ether_drop: 2 },
              revealSecretPortal: true,
            },
          },
          {
            id: 'riddle_sanctum_room',
            question: 'J\'ai une seule entrée mais des milliers de sorties. On me traverse sans me voir. Qui suis-je ?',
            options: [
              { id: 'labyrinth', text: 'Un labyrinthe' },
              { id: 'book', text: 'Un livre' },
              { id: 'dream', text: 'Le reve' },
            ],
            correctOptionId: 'book',
            successText: 'Le sanctuaire reconnaît ta sagesse. Une faille s\'ouvre.',
            failText: 'Myra détourne les yeux. Plus d\'essai.',
            reward: {
              gold: 88,
              materials: { boss_shard: 1 },
              revealSecretPortal: true,
            },
          },
          {
            id: 'riddle_sanctum_break',
            question: 'Plus on me brise, plus je deviens utile. On me jette après m\'avoir utilisé. Qui suis-je ?',
            options: [
              { id: 'egg', text: 'Un oeuf' },
              { id: 'nut', text: 'Une noix' },
              { id: 'silence', text: 'Le silence' },
            ],
            correctOptionId: 'egg',
            successText: 'Myra valide. Un portail secret pulse dans le sanctuaire.',
            failText: 'La Sphinx garde le passage ferme.',
            reward: {
              gold: 91,
              materials: { ether_drop: 1, boss_shard: 1 },
              revealSecretPortal: true,
            },
          },
          {
            id: 'riddle_sanctum_never',
            question: 'Je suis devant toi mais tu ne me vois jamais. Je suis derriere le passe. Qui suis-je ?',
            options: [
              { id: 'future', text: 'L avenir' },
              { id: 'past', text: 'Le passe' },
              { id: 'present', text: 'Le present' },
            ],
            correctOptionId: 'future',
            successText: 'Le sanctuaire répond. Une faille cachée s\'ouvre.',
            failText: 'Myra ne réagit pas. Tentative épuisée.',
            reward: {
              gold: 89,
              materials: { ether_drop: 2 },
              revealSecretPortal: true,
            },
          },
          {
            id: 'riddle_sanctum_hand',
            question: 'J\'ai une main qui ne serre jamais. Je marque le temps sans bouger. Qui suis-je ?',
            options: [
              { id: 'clock', text: 'Une horloge' },
              { id: 'statue', text: 'Une statue' },
              { id: 'tree', text: 'Un arbre' },
            ],
            correctOptionId: 'clock',
            successText: 'Myra trace un rune. Le portail secret apparaît.',
            failText: 'La Sphinx refuse. Le passage reste ferme pour cette run.',
            reward: {
              gold: 93,
              materials: { boss_shard: 1 },
              revealSecretPortal: true,
            },
          },
          {
            id: 'riddle_sanctum_consume',
            question: 'Je dévore tout: pierre, fer, rois. Le temps m\'affaiblit. Qui suis-je ?',
            options: [
              { id: 'rust', text: 'La rouille' },
              { id: 'fire', text: 'Le feu' },
              { id: 'worm', text: 'Un ver' },
            ],
            correctOptionId: 'rust',
            successText: 'Le sanctuaire répond à ta voix. Une faille cachée s\'ouvre.',
            failText: 'Myra détourne le regard. Plus aucune tentative.',
            reward: {
              gold: 90,
              materials: { ether_drop: 2 },
              revealSecretPortal: true,
            },
          },
          {
            id: 'riddle_sanctum_voice',
            question: 'Je peux crier sans bouche. Je peux frapper sans main. Les murs me repètent. Qui suis-je ?',
            options: [
              { id: 'echo', text: 'L echo' },
              { id: 'wind', text: 'Le vent' },
              { id: 'thunder', text: 'Le tonnerre' },
            ],
            correctOptionId: 'echo',
            successText: 'Myra valide. Un portail secret pulse.',
            failText: 'La Sphinx garde le passage ferme.',
            reward: {
              gold: 94,
              materials: { boss_shard: 1 },
              revealSecretPortal: true,
            },
          },
          {
            id: 'riddle_sanctum_bank',
            question: 'J\'ai des rivières sans eau, des forêts sans arbres, des villes sans maisons. Qui suis-je ?',
            options: [
              { id: 'map', text: 'Une carte' },
              { id: 'dream', text: 'Le reve' },
              { id: 'memory', text: 'La mémoire' },
            ],
            correctOptionId: 'map',
            successText: 'Le sanctuaire reconnaît ta réponse. Une faille s\'ouvre.',
            failText: 'Myra ne dit rien. Occasion perdue.',
            reward: {
              gold: 92,
              materials: { ether_drop: 2 },
              revealSecretPortal: true,
            },
          },
          {
            id: 'riddle_sanctum_measure',
            question: 'Plus tu me donnes, plus j\'en ai. Plus tu me prends, plus il m\'en reste. Qui suis-je ?',
            options: [
              { id: 'hole', text: 'Un trou' },
              { id: 'debt', text: 'Une dette' },
              { id: 'knowledge', text: 'Le savoir' },
            ],
            correctOptionId: 'hole',
            successText: 'Myra trace un cercle. Le portail secret apparaît.',
            failText: 'La Sphinx refuse. Le passage reste ferme.',
            reward: {
              gold: 91,
              materials: { boss_shard: 1 },
              revealSecretPortal: true,
            },
          },
        ],
      },
      {
        id: 'npc_etcher',
        name: 'Kail le Graveur',
        role: 'craft',
        x: 4,
        y: 4,
        portrait: ROGUE_ASSET,
        dialogue: 'Je grave des runes sur les armes epiques et legendaires.',
      },
    ],
    resources: [
      { id: 'sanctum_ore_1', type: 'ore', x: 3, y: 3, charges: 3 },
      { id: 'sanctum_ore_2', type: 'ore', x: 12, y: 7, charges: 3 },
      { id: 'sanctum_herb_1', type: 'herb', x: 6, y: 8, charges: 3 },
      { id: 'sanctum_tree_1', type: 'tree', x: 10, y: 4, charges: 2 },
    ],
    chests: [
      { id: 'chest_sanctum_1', x: 7, y: 5, rarityBias: 'legendary' },
      { id: 'chest_sanctum_2', x: 13, y: 9, rarityBias: 'epic' },
    ],
    enemies: [
      { id: 'e_sanctum_1', templateId: 'obsidian_reaper', x: 5, y: 6 },
      { id: 'e_sanctum_2', templateId: 'whisper_thief', x: 9, y: 6 },
      { id: 'e_sanctum_3', templateId: 'bone_guard', x: 11, y: 4 },
      { id: 'e_sanctum_4', templateId: 'crypt_mage', x: 4, y: 8 },
      { id: 'e_sanctum_5', templateId: 'obsidian_reaper', x: 12, y: 3 },
    ],
    boss: { id: 'boss_sanctum', templateId: 'boss_forge_titan', x: 13, y: 2 },
    tiles: [
      '################',
      '#......#.......#',
      '#.####.#.###.#.#',
      '#.#....#...#.#.#',
      '#.#.######.#.#.#',
      '#.#......#.#...#',
      '#.######.#.###.#',
      '#......#.#.....#',
      '#.####.#.#####.#',
      '#....#.#.......#',
      '#..............#',
      '################',
    ],
  },

  abyssal_archive: {
    id: 'abyssal_archive',
    name: 'Archive Abyssale',
    levelRange: '10-12',
    isSecret: false,
    background: '/assets/Environment/Tilesets/Dungeon_Tiles.png',
    width: 16,
    height: 12,
    start: { x: 1, y: 1 },
    exit: { x: 14, y: 10, targetMapId: 'ember_crossroads' },
    secretPortal: null,
    backPortal: {
      x: 1,
      y: 10,
      targetMapId: 'shattered_sanctum',
    },
    npcs: [
      {
        id: 'npc_archivist',
        name: 'Seline l Archiviste',
        role: 'merchant',
        x: 2,
        y: 2,
        portrait: WIZZARD_ASSET,
        dialogue: 'Je troque des potions tactiques contre de l\'or. Elles sauvent des runs.',
      },
      {
        id: 'npc_warder',
        name: 'Vark le Gardien',
        role: 'healer',
        x: 10,
        y: 2,
        portrait: KNIGHT_ASSET,
        dialogue: 'Soins complets et benediction. Tu vas en avoir besoin.',
      },
      {
        id: 'npc_respec_scholar',
        name: 'Orim le Delieur',
        role: 'respec',
        x: 7,
        y: 2,
        portrait: KNIGHT_ASSET,
        dialogue: 'Je peux réinitialiser ton arbre passif une seule fois: 200 or, pas de second essai.',
      },
    ],
    resources: [
      { id: 'archive_ore_1', type: 'ore', x: 4, y: 4, charges: 3 },
      { id: 'archive_ore_2', type: 'ore', x: 11, y: 8, charges: 3 },
      { id: 'archive_herb_1', type: 'herb', x: 6, y: 6, charges: 3 },
      { id: 'archive_tree_1', type: 'tree', x: 13, y: 3, charges: 2 },
    ],
    chests: [
      { id: 'chest_archive_1', x: 8, y: 8, rarityBias: 'mythic' },
      { id: 'chest_archive_2', x: 3, y: 7, rarityBias: 'legendary' },
    ],
    enemies: [
      { id: 'e_archive_1', templateId: 'obsidian_reaper', x: 5, y: 5 },
      { id: 'e_archive_2', templateId: 'whisper_thief', x: 7, y: 6 },
      { id: 'e_archive_3', templateId: 'crypt_mage', x: 10, y: 5 },
      { id: 'e_archive_4', templateId: 'bone_guard', x: 12, y: 7 },
      { id: 'e_archive_5', templateId: 'obsidian_reaper', x: 9, y: 3 },
    ],
    boss: { id: 'boss_archive', templateId: 'boss_obsidian_archon', x: 14, y: 2 },
    tiles: [
      '################',
      '#..............#',
      '#.#####.######.#',
      '#.#...#....#...#',
      '#.#.#.####.#.###',
      '#...#....#.#...#',
      '###.####.#.###.#',
      '#...#..#.#.....#',
      '#.###..#.#####.#',
      '#.....##.......#',
      '#..............#',
      '################',
    ],
  },

  ember_crossroads: {
    id: 'ember_crossroads',
    name: 'Carrefour des Braises',
    levelRange: '11-13',
    isSecret: false,
    background: '/assets/Environment/Tilesets/Floors_Tiles.png',
    width: 16,
    height: 12,
    start: { x: 1, y: 1 },
    exit: { x: 14, y: 10, targetMapId: 'veil_harbor' },
    secretPortal: null,
    backPortal: {
      x: 1,
      y: 10,
      targetMapId: 'abyssal_archive',
    },
    npcs: [
      {
        id: 'npc_crossroads_merchant',
        name: 'Ryn le Convoyeur',
        role: 'merchant',
        x: 2,
        y: 2,
        portrait: ROGUE_ASSET,
        dialogue: 'Entre deux royaumes, je vends ce qui sauve la peau.',
      },
      {
        id: 'npc_crossroads_smith',
        name: 'Torga la Forgeuse',
        role: 'craft',
        x: 12,
        y: 2,
        portrait: KNIGHT_ASSET,
        dialogue: 'Si tu as les materiaux, je te rends pret pour la suite.',
      },
    ],
    resources: [
      { id: 'cross_tree_1', type: 'tree', x: 4, y: 3, charges: 3 },
      { id: 'cross_ore_1', type: 'ore', x: 11, y: 4, charges: 3 },
      { id: 'cross_herb_1', type: 'herb', x: 8, y: 8, charges: 3 },
      { id: 'cross_ore_2', type: 'ore', x: 13, y: 7, charges: 2 },
    ],
    chests: [
      { id: 'chest_cross_1', x: 3, y: 8, rarityBias: 'epic' },
      { id: 'chest_cross_2', x: 10, y: 9, rarityBias: 'legendary' },
    ],
    enemies: [
      { id: 'e_cross_1', templateId: 'bone_guard', x: 5, y: 6 },
      { id: 'e_cross_2', templateId: 'obsidian_reaper', x: 9, y: 6 },
      { id: 'e_cross_3', templateId: 'crypt_mage', x: 12, y: 5 },
      { id: 'e_cross_4', templateId: 'whisper_thief', x: 7, y: 3 },
      { id: 'e_cross_5', templateId: 'obsidian_reaper', x: 13, y: 9 },
    ],
    boss: { id: 'boss_crossroads', templateId: 'boss_forge_titan', x: 14, y: 2 },
    tiles: [
      '################',
      '#..............#',
      '#..####...###..#',
      '#......#.......#',
      '#.####.#.#####.#',
      '#.#....#.....#.#',
      '#.#.######.#.#.#',
      '#...#....#.#...#',
      '###.#.##.#.###.#',
      '#...#....#.....#',
      '#..............#',
      '################',
    ],
  },

  veil_harbor: {
    id: 'veil_harbor',
    name: 'Havre du Voile',
    levelRange: '12-14',
    isSecret: false,
    background: '/assets/Environment/Tilesets/Water_tiles.png',
    width: 16,
    height: 12,
    start: { x: 1, y: 10 },
    exit: { x: 14, y: 1, targetMapId: 'ending' },
    secretPortal: null,
    backPortal: {
      x: 1,
      y: 1,
      targetMapId: 'ember_crossroads',
    },
    npcs: [
      {
        id: 'npc_harbor_healer',
        name: 'Naya des Marees',
        role: 'healer',
        x: 2,
        y: 9,
        portrait: WIZZARD_ASSET,
        dialogue: 'Le dernier trajet est rude. Repare tes forces avant de partir.',
      },
      {
        id: 'npc_harbor_lore',
        name: 'Eldran le Veilleur',
        role: 'lore',
        x: 11,
        y: 2,
        portrait: KNIGHT_ASSET,
        dialogue: 'Le coeur du Voile n\'est plus loin. Chaque pas compte.',
        riddlePool: [
          {
            id: 'riddle_harbor_1',
            question: 'Je prends des pages sans lire, des lettres sans ecrire, et je porte des villes sans marcher. Qui suis-je ?',
            options: [
              { id: 'atlas', text: 'Un atlas' },
              { id: 'scribe', text: 'Un scribe' },
              { id: 'banner', text: 'Une banniere' },
            ],
            correctOptionId: 'atlas',
            successText: 'Eldran incline la tête. Ton raisonnement perce les brumes.',
            failText: 'Eldran ferme son grimoire. Rien ne bouge.',
            reward: { gold: 95, materials: { ether_drop: 2 } },
          },
          {
            id: 'riddle_harbor_2',
            question: 'Plus je suis vrai, moins on me croit. Plus je mens, plus on me suit. Qui suis-je ?',
            options: [
              { id: 'rumor', text: 'Une rumeur' },
              { id: 'judge', text: 'Un juge' },
              { id: 'mirror', text: 'Un miroir' },
            ],
            correctOptionId: 'rumor',
            successText: 'Le Veilleur sourit: ta logique tient.',
            failText: 'Le silence répond à ta place.',
            reward: { gold: 90, materials: { resin: 3 } },
          },
          {
            id: 'riddle_harbor_3',
            question: 'Je naquis quand tu me nommes, je meurs quand tu me comprends. Qui suis-je ?',
            options: [
              { id: 'mystery', text: 'Une enigme' },
              { id: 'promise', text: 'Une promesse' },
              { id: 'fear', text: 'La peur' },
            ],
            correctOptionId: 'mystery',
            successText: 'Une rune se grave sur ta route.',
            failText: 'Les runes se figent. Aucun effet.',
            reward: { gold: 96, materials: { boss_shard: 1 } },
          },
          {
            id: 'riddle_harbor_4',
            question: 'Je suis plus lourd qu\'un souvenir, plus léger qu\'un serment, et pourtant je fais tomber des royaumes. Qui suis-je ?',
            options: [
              { id: 'word', text: 'Un mot' },
              { id: 'stone', text: 'Une pierre' },
              { id: 'coin', text: 'Une piece' },
            ],
            correctOptionId: 'word',
            successText: 'Le Veilleur ouvre une nouvelle ligne dans ses archives.',
            failText: 'Le parchemin reste clos.',
            reward: { gold: 88, materials: { herb: 3 } },
          },
          {
            id: 'riddle_harbor_5',
            question: 'Je cours en cercle sans jamais tourner, je monte sans grimper, et j\'achève ce que je crée. Qui suis-je ?',
            options: [
              { id: 'time', text: 'Le temps' },
              { id: 'river', text: 'Une rivière' },
              { id: 'forge', text: 'Une forge' },
            ],
            correctOptionId: 'time',
            successText: 'Eldran valide ton intuition.',
            failText: 'Erreur. Le monde continue sans te répondre.',
            reward: { gold: 92, materials: { ore: 3 } },
          },
          {
            id: 'riddle_harbor_6',
            question: 'Je peux être plein et vide à la fois. Je n\'existe que par mes limites. Qui suis-je ?',
            options: [
              { id: 'set', text: 'Un ensemble' },
              { id: 'box', text: 'Une boite' },
              { id: 'cloud', text: 'Un nuage' },
            ],
            correctOptionId: 'set',
            successText: 'La logique du Voile te reconnaît.',
            failText: 'Aucune reaction dans la salle.',
            reward: { gold: 93, materials: { obsidian_fragment: 2 } },
          },
          {
            id: 'riddle_harbor_7',
            question: 'Je suis vu par tous, compris par peu, et inverse tout sans bouger. Qui suis-je ?',
            options: [
              { id: 'mirror', text: 'Un miroir' },
              { id: 'storm', text: 'Une tempete' },
              { id: 'king', text: 'Un roi' },
            ],
            correctOptionId: 'mirror',
            successText: 'Un éclat bleu pulse un instant.',
            failText: 'Le reflet s\'éteint.',
            reward: { gold: 97, materials: { ether_drop: 2 } },
          },
          {
            id: 'riddle_harbor_8',
            question: 'Je n\'ai ni debut ni fin, mais je tranche tout ce qui me traverse. Qui suis-je ?',
            options: [
              { id: 'line', text: 'Une ligne' },
              { id: 'blade', text: 'Une lame' },
              { id: 'wind', text: 'Le vent' },
            ],
            correctOptionId: 'line',
            successText: 'La carte se complete d\'un trait net.',
            failText: 'Le trait disparait aussitot.',
            reward: { gold: 91, materials: { wood: 3 } },
          },
          {
            id: 'riddle_harbor_9',
            question: 'Je suis toujours demain dans la bouche des faibles et toujours aujourd\'hui dans la main des forts. Qui suis-je ?',
            options: [
              { id: 'action', text: 'L action' },
              { id: 'luck', text: 'La chance' },
              { id: 'sleep', text: 'Le sommeil' },
            ],
            correctOptionId: 'action',
            successText: 'Eldran approuve: tu avances sans attendre.',
            failText: 'Le Veilleur ne dit rien. Rien ne se passe.',
            reward: { gold: 94, materials: { resin: 2, herb: 2 } },
          },
          {
            id: 'riddle_harbor_10',
            question: 'Je suis la seule cle qui n\'ouvre aucune porte mais ferme toutes les erreurs. Qui suis-je ?',
            options: [
              { id: 'proof', text: 'La preuve' },
              { id: 'lock', text: 'Un verrou' },
              { id: 'torch', text: 'Une torche' },
            ],
            correctOptionId: 'proof',
            successText: 'Le dernier sceau du Veilleur cède.',
            failText: 'La salle reste immobile.',
            reward: { gold: 100, materials: { boss_shard: 1, ether_drop: 1 } },
          },
          {
            id: 'riddle_harbor_11',
            question: 'Je suis plus vieux que le temps, plus jeune que l\'instant. Je porte tout sans bouger. Qui suis-je ?',
            options: [
              { id: 'space', text: 'L espace' },
              { id: 'memory', text: 'La mémoire' },
              { id: 'earth', text: 'La terre' },
            ],
            correctOptionId: 'space',
            successText: 'Eldran incline la tête. Ta logique perce les brumes.',
            failText: 'Le Veilleur ferme son grimoire.',
            reward: { gold: 98, materials: { ether_drop: 2, resin: 1 } },
          },
          {
            id: 'riddle_harbor_12',
            question: 'On me cherche quand on m\'a perdu. On m\'évite quand on m\'a trouve. Je change tout sans bouger. Qui suis-je ?',
            options: [
              { id: 'truth', text: 'La vérité' },
              { id: 'treasure', text: 'Un trésor' },
              { id: 'death', text: 'La mort' },
            ],
            correctOptionId: 'truth',
            successText: 'Une rune se grave sur ta route.',
            failText: 'Les runes se figent. Aucun effet.',
            reward: { gold: 99, materials: { boss_shard: 1, herb: 2 } },
          },
          {
            id: 'riddle_harbor_13',
            question: 'Je n\'ai pas de langue mais je réponds à toutes les questions. On me consulte sans me parler. Qui suis-je ?',
            options: [
              { id: 'book', text: 'Un livre' },
              { id: 'oracle', text: 'Un oracle' },
              { id: 'mirror', text: 'Un miroir' },
            ],
            correctOptionId: 'book',
            successText: 'Le Veilleur ouvre une nouvelle ligne dans ses archives.',
            failText: 'Le parchemin reste clos.',
            reward: { gold: 97, materials: { ether_drop: 2, ore: 2 } },
          },
          {
            id: 'riddle_harbor_14',
            question: 'Je peux remplir une salle mais pas occuper d\'espace. On me donne sans me perdre. Qui suis-je ?',
            options: [
              { id: 'light', text: 'La lumière' },
              { id: 'sound', text: 'Le son' },
              { id: 'fear', text: 'La peur' },
            ],
            correctOptionId: 'light',
            successText: 'Eldran valide ton intuition.',
            failText: 'Le monde continue sans te répondre.',
            reward: { gold: 96, materials: { obsidian_fragment: 2 } },
          },
          {
            id: 'riddle_harbor_15',
            question: 'Je suis la fin de tout ce qui commence et le debut de tout ce qui finit. On me traverse sans me voir. Qui suis-je ?',
            options: [
              { id: 'letter_e', text: 'La lettre E' },
              { id: 'death', text: 'La mort' },
              { id: 'threshold', text: 'Le seuil' },
            ],
            correctOptionId: 'letter_e',
            successText: 'Le dernier sceau du Veilleur cède. Tu as franchi l\'épreuve.',
            failText: 'La salle reste immobile.',
            reward: { gold: 101, materials: { boss_shard: 1, ether_drop: 2 } },
          },
        ],
      },
    ],
    resources: [
      { id: 'harbor_ore_1', type: 'ore', x: 4, y: 8, charges: 3 },
      { id: 'harbor_tree_1', type: 'tree', x: 8, y: 9, charges: 3 },
      { id: 'harbor_herb_1', type: 'herb', x: 12, y: 8, charges: 3 },
      { id: 'harbor_herb_2', type: 'herb', x: 6, y: 4, charges: 2 },
    ],
    chests: [
      { id: 'chest_harbor_1', x: 6, y: 7, rarityBias: 'legendary' },
      { id: 'chest_harbor_2', x: 13, y: 3, rarityBias: 'mythic' },
    ],
    enemies: [
      { id: 'e_harbor_1', templateId: 'obsidian_reaper', x: 5, y: 6 },
      { id: 'e_harbor_2', templateId: 'whisper_thief', x: 7, y: 6 },
      { id: 'e_harbor_3', templateId: 'crypt_mage', x: 10, y: 5 },
      { id: 'e_harbor_4', templateId: 'bone_guard', x: 12, y: 6 },
      { id: 'e_harbor_5', templateId: 'obsidian_reaper', x: 13, y: 8 },
    ],
    boss: { id: 'boss_harbor', templateId: 'boss_obsidian_archon', x: 14, y: 9 },
    tiles: [
      '################',
      '#..............#',
      '#.####....####.#',
      '#....#....#....#',
      '#.##.######.##.#',
      '#..............#',
      '#.######..####.#',
      '#......#..#....#',
      '#.####.#..#.##.#',
      '#..............#',
      '#..............#',
      '################',
    ],
  },

  lunar_shrine: {
    id: 'lunar_shrine',
    name: 'Sanctuaire Lunaire (Secret)',
    levelRange: '7-9',
    isSecret: true,
    background: '/assets/Environment/Tilesets/Water_tiles.png',
    width: 16,
    height: 12,
    start: { x: 1, y: 1 },
    exit: { x: 14, y: 10, targetMapId: 'return' },
    secretPortal: null,
    backPortal: null,
    npcs: [
      {
        id: 'npc_oracle',
        name: 'Oracle des lacs',
        role: 'healer',
        x: 3,
        y: 2,
        portrait: WIZZARD_ASSET,
        dialogue: 'Tu as trouvé une zone secrete. Ici, chaque erreur coûte cher.',
      },
    ],
    resources: [
      { id: 'lunar_ore_1', type: 'ore', x: 11, y: 2, charges: 4 },
      { id: 'lunar_herb_1', type: 'herb', x: 6, y: 9, charges: 4 },
      { id: 'lunar_tree_1', type: 'tree', x: 13, y: 8, charges: 3 },
    ],
    chests: [{ id: 'chest_lunar_1', x: 4, y: 8, rarityBias: 'legendary' },
             { id: 'chest_lunar_1', x: 8, y: 4, rarityBias: 'legendary' }
    ],
    enemies: [
      { id: 'e_lunar_1', templateId: 'obsidian_reaper', x: 9, y: 3 },
      { id: 'e_lunar_2', templateId: 'whisper_thief', x: 10, y: 6 },
      { id: 'e_lunar_3', templateId: 'crypt_mage', x: 5, y: 6 },
    ],
    boss: { id: 'boss_mirror', templateId: 'boss_mirror_eater', x: 12, y: 9 },
    tiles: [
      '################',
      '#..............#',
      '#..~~~~..~~~~..#',
      '#..............#',
      '#.####....####.#',
      '#..............#',
      '#..~~~~..~~~~..#',
      '#..............#',
      '#.####....####.#',
      '#..............#',
      '#..............#',
      '################',
    ],
  },

  forgotten_foundry: {
    id: 'forgotten_foundry',
    name: 'Fonderie Oubliee (Secret)',
    levelRange: '8-10',
    isSecret: true,
    background: '/assets/Environment/Tilesets/Wall_Variations.png',
    width: 16,
    height: 12,
    start: { x: 1, y: 10 },
    exit: { x: 14, y: 1, targetMapId: 'return' },
    secretPortal: null,
    backPortal: null,
    noSpawnZones: [{ x: 6, y: 5, width: 4, height: 3 }],
    npcs: [
      {
        id: 'npc_forge_ghost',
        name: 'Spectre du Four',
        role: 'craft',
        x: 2,
        y: 9,
        portrait: KNIGHT_ASSET,
        dialogue: 'Je n\'accepte que des minerais rares. En échange, je te rends plus fort.',
      },
    ],
    resources: [
      { id: 'forge_ore_1', type: 'ore', x: 4, y: 8, charges: 4 },
      { id: 'forge_ore_2', type: 'ore', x: 11, y: 5, charges: 4 },
      { id: 'forge_tree_1', type: 'tree', x: 8, y: 9, charges: 3 },
    ],
    chests: [
      { id: 'chest_forge_1', x: 6, y: 9, rarityBias: 'legendary' },
      { id: 'chest_forge_2', x: 12, y: 2, rarityBias: 'epic' },
    ],
    enemies: [
      { id: 'e_forge_1', templateId: 'bone_guard', x: 5, y: 7 },
      { id: 'e_forge_2', templateId: 'obsidian_reaper', x: 9, y: 6 },
      { id: 'e_forge_3', templateId: 'whisper_thief', x: 12, y: 4 },
      { id: 'e_forge_4', templateId: 'crypt_mage', x: 7, y: 4 },
    ],
    boss: { id: 'boss_forge', templateId: 'boss_forge_titan', x: 13, y: 8 },
    tiles: [
      '################',
      '#..............#',
      '#..##....##....#',
      '#..............#',
      '#....##..##....#',
      '#..............#',
      '#..###....###..#',
      '#..............#',
      '#....######....#',
      '#..............#',
      '#..##....##....#',
      '#..............#',
      '################',
    ],
  },

  echoing_vault: {
    id: 'echoing_vault',
    name: 'Voute des Echos (Secret)',
    levelRange: '9-11',
    isSecret: true,
    background: '/assets/Environment/Tilesets/Water_tiles.png',
    width: 16,
    height: 12,
    start: { x: 1, y: 1 },
    exit: { x: 14, y: 10, targetMapId: 'return' },
    secretPortal: null,
    backPortal: null,
    npcs: [
      {
        id: 'npc_vault_keeper',
        name: 'Eris la Gardienne',
        role: 'healer',
        x: 2,
        y: 2,
        portrait: ROGUE_ASSET,
        dialogue: 'Bienvenue dans la voute. Ici, les reliques tombent mais les ennemis frappent vite.',
      },
    ],
    resources: [
      { id: 'vault_ore_1', type: 'ore', x: 11, y: 3, charges: 4 },
      { id: 'vault_ore_2', type: 'ore', x: 9, y: 8, charges: 4 },
      { id: 'vault_herb_1', type: 'herb', x: 6, y: 5, charges: 3 },
      { id: 'vault_tree_1', type: 'tree', x: 13, y: 8, charges: 3 },
    ],
    chests: [
      { id: 'chest_vault_1', x: 4, y: 8, rarityBias: 'mythic' },
      { id: 'chest_vault_2', x: 12, y: 2, rarityBias: 'legendary' },
    ],
    enemies: [
      { id: 'e_vault_1', templateId: 'obsidian_reaper', x: 5, y: 6 },
      { id: 'e_vault_2', templateId: 'whisper_thief', x: 9, y: 6 },
      { id: 'e_vault_3', templateId: 'crypt_mage', x: 10, y: 4 },
      { id: 'e_vault_4', templateId: 'bone_guard', x: 12, y: 7 },
    ],
    boss: { id: 'boss_vault', templateId: 'boss_mirror_eater', x: 13, y: 9 },
    tiles: [
      '################',
      '#..............#',
      '#..~~~~..~~~~..#',
      '#..............#',
      '#.####..##.###.#',
      '#..............#',
      '#..~~~~..~~~~..#',
      '#..............#',
      '#.###.####.###.#',
      '#..............#',
      '#..............#',
      '################',
    ],
  },
}

export const MAP_ORDER = [
  'ashen_meadow',
  'whispering_catacombs',
  'obsidian_citadel',
  'shattered_sanctum',
  'abyssal_archive',
  'ember_crossroads',
  'veil_harbor',
]

export function getMapById(mapId) {
  return MAPS[mapId] ?? null
}

export function mapIsWalkable(map, x, y, tilesOverride = null) {
  if (!map) {
    return false
  }
  if (x < 0 || y < 0 || x >= map.width || y >= map.height) {
    return false
  }
  const tiles = tilesOverride ?? map.tiles
  return tiles?.[y]?.[x] === '.'
}
