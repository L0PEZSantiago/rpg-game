import { KNIGHT_ASSET, ROGUE_ASSET, WIZZARD_ASSET } from './constants'

export const MAPS = {
  ashen_meadow: {
    id: 'ashen_meadow',
    name: 'Prairie des Cendres',
    levelRange: '1-3',
    isSecret: false,
    background: '/assets/Environment/Tilesets/Floors_Tiles.png',
    width: 16,
    height: 12,
    start: { x: 1, y: 1 },
    exit: { x: 14, y: 10, targetMapId: 'whispering_catacombs' },
    secretPortal: {
      x: 2,
      y: 10,
      targetMapId: 'lunar_shrine',
      revealChance: 0.22,
    },
    backPortal: null,
    npcs: [
      {
        id: 'npc_cartographer',
        name: 'Iria la Cartographe',
        role: 'lore',
        x: 2,
        y: 2,
        portrait: WIZZARD_ASSET,
        dialogue: 'La Brume ne ment jamais. Chaque eclat revele une route oubliee.',
        riddlePool: [
          {
            id: 'riddle_ashen_map',
            question: 'Je revele les routes cachees sans marcher. Qui suis-je ?',
            options: [
              { id: 'wind', text: 'Le vent' },
              { id: 'map', text: 'Une carte' },
              { id: 'moon', text: 'La lune' },
            ],
            correctOptionId: 'map',
            successText: 'Iria te felicite et devoile un portail cache.',
            failText: 'Iria secoue la tete. La Brume se referme pour cette fois.',
            reward: {
              gold: 40,
              materials: { ether_drop: 1 },
              revealSecretPortal: true,
            },
          },
          {
            id: 'riddle_ashen_echo',
            question: 'Plus tu m enlèves, plus je deviens grand. Qui suis-je ?',
            options: [
              { id: 'hole', text: 'Un trou' },
              { id: 'stone', text: 'Une pierre' },
              { id: 'river', text: 'Une riviere' },
            ],
            correctOptionId: 'hole',
            successText: 'Le sol tremble: un souffle secret traverse la prairie.',
            failText: 'Iria marque une croix sur ton carnet. Occasion manquée.',
            reward: {
              gold: 42,
              materials: { resin: 2 },
              revealSecretPortal: true,
            },
          },
          {
            id: 'riddle_ashen_time',
            question: 'Je cours sans jambe, je chante sans bouche. Qui suis-je ?',
            options: [
              { id: 'water', text: 'L eau' },
              { id: 'bird', text: 'Un oiseau' },
              { id: 'fire', text: 'Le feu' },
            ],
            correctOptionId: 'water',
            successText: 'Iria t\'offre un mot-clé et le secret s ouvre.',
            failText: 'La reponse se dissipe. Le secret ne reagit plus.',
            reward: {
              gold: 45,
              materials: { herb: 2 },
              revealSecretPortal: true,
            },
          },
        ],
      },
      {
        id: 'npc_woodsmith',
        name: 'Bram le Scieur',
        role: 'craft',
        x: 5,
        y: 9,
        portrait: KNIGHT_ASSET,
        dialogue: 'Bois, minerai, os. Je fabrique ce que tu sais payer ou recolter.',
      },
      {
        id: 'npc_mender',
        name: 'Sera la Soin-lame',
        role: 'healer',
        x: 9,
        y: 2,
        portrait: ROGUE_ASSET,
        dialogue: 'Je referme tes plaies, mais pas gratuitement.',
      },
    ],
    resources: [
      { id: 'ash_tree_1', type: 'tree', x: 4, y: 3, charges: 3 },
      { id: 'ash_tree_2', type: 'tree', x: 6, y: 6, charges: 3 },
      { id: 'ash_ore_1', type: 'ore', x: 12, y: 4, charges: 2 },
      { id: 'ash_ore_2', type: 'ore', x: 11, y: 8, charges: 2 },
      { id: 'ash_herb_1', type: 'herb', x: 7, y: 3, charges: 3 },
      { id: 'ash_herb_2', type: 'herb', x: 13, y: 5, charges: 3 },
    ],
    chests: [
      { id: 'chest_ash_1', x: 10, y: 9, rarityBias: 'rare' },
      { id: 'chest_ash_2', x: 3, y: 8, rarityBias: 'uncommon' },
    ],
    enemies: [
      { id: 'e_ash_1', templateId: 'ash_hound', x: 10, y: 3 },
      { id: 'e_ash_2', templateId: 'ash_hound', x: 12, y: 7 },
      { id: 'e_ash_3', templateId: 'shrouded_orc', x: 8, y: 8 },
      { id: 'e_ash_4', templateId: 'shrouded_orc', x: 4, y: 6 },
    ],
    boss: { id: 'boss_ash', templateId: 'boss_ash_colossus', x: 13, y: 2 },
    tiles: [
      '################',
      '#..............#',
      '#..~~...##.....#',
      '#......###.....#',
      '#......#.......#',
      '#......#..~~...#',
      '#..........#...#',
      '#..###.....#...#',
      '#..#.......#...#',
      '#..#...........#',
      '#..............#',
      '################',
    ],
  },

  whispering_catacombs: {
    id: 'whispering_catacombs',
    name: 'Catacombes Murmurantes',
    levelRange: '4-6',
    isSecret: false,
    background: '/assets/Environment/Tilesets/Wall_Tiles.png',
    width: 16,
    height: 12,
    start: { x: 1, y: 10 },
    exit: { x: 14, y: 1, targetMapId: 'obsidian_citadel' },
    secretPortal: {
      x: 8,
      y: 10,
      targetMapId: 'forgotten_foundry',
      revealChance: 0.28,
    },
    backPortal: {
      x: 1,
      y: 1,
      targetMapId: 'ashen_meadow',
    },
    npcs: [
      {
        id: 'npc_broker',
        name: 'Nell le Courtier',
        role: 'merchant',
        x: 2,
        y: 9,
        portrait: ROGUE_ASSET,
        dialogue: 'Besoin de ravitaillement ? Tu es au bon endroit.',
      },
      {
        id: 'npc_keeper',
        name: 'Gardien Yorn',
        role: 'lore',
        x: 10,
        y: 8,
        portrait: KNIGHT_ASSET,
        dialogue: 'Le Roi des Os garde la sortie. Sans sa chute, personne ne passe.',
        riddlePool: [
          {
            id: 'riddle_cat_fire',
            question: 'Plus je mange, plus je grandis. Si je bois, je meurs. Qui suis-je ?',
            options: [
              { id: 'fire', text: 'Le feu' },
              { id: 'wolf', text: 'Un loup' },
              { id: 'stone', text: 'Une pierre' },
            ],
            correctOptionId: 'fire',
            successText: 'Yorn t accorde son sceau et devoile un passage cache.',
            failText: 'Yorn referme son heaume. C est rate pour cette expedition.',
            reward: {
              gold: 70,
              materials: { boss_shard: 1 },
              revealSecretPortal: true,
            },
          },
          {
            id: 'riddle_cat_shadow',
            question: 'Je te suis partout, mais disparais dans le noir. Qui suis-je ?',
            options: [
              { id: 'shadow', text: 'Ton ombre' },
              { id: 'fear', text: 'La peur' },
              { id: 'dust', text: 'La poussiere' },
            ],
            correctOptionId: 'shadow',
            successText: 'Yorn te juge digne. Le mecanisme des catacombes s active.',
            failText: 'Le Gardien reste silencieux. Aucun second essai.',
            reward: {
              gold: 66,
              materials: { bone_dust: 2 },
              revealSecretPortal: true,
            },
          },
        ],
      },
      {
        id: 'npc_anvil',
        name: 'Anvil Nox',
        role: 'craft',
        x: 5,
        y: 2,
        portrait: WIZZARD_ASSET,
        dialogue: 'La forge ancestrale reagit aux os charges de mana.',
      },
    ],
    resources: [
      { id: 'catacomb_ore_1', type: 'ore', x: 4, y: 4, charges: 3 },
      { id: 'catacomb_ore_2', type: 'ore', x: 11, y: 4, charges: 3 },
      { id: 'catacomb_herb_1', type: 'herb', x: 6, y: 8, charges: 2 },
      { id: 'catacomb_tree_1', type: 'tree', x: 13, y: 8, charges: 2 },
    ],
    chests: [
      { id: 'chest_cat_1', x: 8, y: 4, rarityBias: 'epic' },
      { id: 'chest_cat_2', x: 2, y: 7, rarityBias: 'rare' },
    ],
    enemies: [
      { id: 'e_cat_1', templateId: 'bone_guard', x: 4, y: 6 },
      { id: 'e_cat_2', templateId: 'crypt_mage', x: 6, y: 4 },
      { id: 'e_cat_3', templateId: 'whisper_thief', x: 9, y: 5 },
      { id: 'e_cat_4', templateId: 'bone_guard', x: 12, y: 7 },
      { id: 'e_cat_5', templateId: 'crypt_mage', x: 13, y: 3 },
    ],
    boss: { id: 'boss_bone', templateId: 'boss_bone_emperor', x: 14, y: 8 },
    tiles: [
      '################',
      '#.......#......#',
      '#.#####.#.####.#',
      '#.#...#.#....#.#',
      '#.#.#.#.####.#.#',
      '#...#.#....#.#.#',
      '###.#.####.#.#.#',
      '#...#......#...#',
      '#.##########.#.#',
      '#............#.#',
      '#..............#',
      '################',
    ],
  },

  obsidian_citadel: {
    id: 'obsidian_citadel',
    name: 'Citadelle d Obsidienne',
    levelRange: '6-8',
    isSecret: false,
    background: '/assets/Environment/Tilesets/Dungeon_Tiles.png',
    width: 16,
    height: 12,
    start: { x: 1, y: 1 },
    exit: { x: 14, y: 10, targetMapId: 'shattered_sanctum' },
    secretPortal: {
      x: 1,
      y: 10,
      targetMapId: 'lunar_shrine',
      revealChance: 0.36,
    },
    backPortal: {
      x: 14,
      y: 1,
      targetMapId: 'whispering_catacombs',
    },
    npcs: [
      {
        id: 'npc_bard',
        name: 'Luthe le Barde borgne',
        role: 'merchant',
        x: 2,
        y: 9,
        portrait: ROGUE_ASSET,
        dialogue: 'Derniere ligne droite. Fais le plein avant les grands halls.',
      },
      {
        id: 'npc_smith_prime',
        name: 'Maitre Baldur',
        role: 'craft',
        x: 7,
        y: 2,
        portrait: KNIGHT_ASSET,
        dialogue: 'Ici, meme les reliques demandent des ajustements.',
      },
    ],
    resources: [
      { id: 'obs_ore_1', type: 'ore', x: 5, y: 3, charges: 3 },
      { id: 'obs_ore_2', type: 'ore', x: 11, y: 3, charges: 3 },
      { id: 'obs_tree_1', type: 'tree', x: 4, y: 9, charges: 2 },
      { id: 'obs_herb_1', type: 'herb', x: 12, y: 8, charges: 2 },
    ],
    chests: [
      { id: 'chest_obs_1', x: 9, y: 7, rarityBias: 'legendary' },
      { id: 'chest_obs_2', x: 2, y: 4, rarityBias: 'epic' },
    ],
    enemies: [
      { id: 'e_obs_1', templateId: 'obsidian_reaper', x: 6, y: 5 },
      { id: 'e_obs_2', templateId: 'obsidian_reaper', x: 10, y: 5 },
      { id: 'e_obs_3', templateId: 'whisper_thief', x: 8, y: 8 },
      { id: 'e_obs_4', templateId: 'crypt_mage', x: 13, y: 4 },
      { id: 'e_obs_5', templateId: 'bone_guard', x: 3, y: 6 },
    ],
    boss: { id: 'boss_archon', templateId: 'boss_obsidian_archon', x: 14, y: 2 },
    tiles: [
      '################',
      '#......#.......#',
      '#.####.#.#####.#',
      '#.#....#.....#.#',
      '#.#.#######.#..#',
      '#.#.......#.#..#',
      '#.#######.#.##.#',
      '#.......#.#....#',
      '#.#####.#.####.#',
      '#.....#.#......#',
      '#..............#',
      '################',
    ],
  },

  shattered_sanctum: {
    id: 'shattered_sanctum',
    name: 'Sanctuaire Brise',
    levelRange: '8-10',
    isSecret: false,
    background: '/assets/Environment/Tilesets/Wall_Variations.png',
    width: 16,
    height: 12,
    start: { x: 1, y: 10 },
    exit: { x: 14, y: 1, targetMapId: 'abyssal_archive' },
    secretPortal: {
      x: 8,
      y: 1,
      targetMapId: 'echoing_vault',
      revealChance: 0.18,
    },
    backPortal: {
      x: 1,
      y: 1,
      targetMapId: 'obsidian_citadel',
    },
    npcs: [
      {
        id: 'npc_quartermaster',
        name: 'Rovan le Logisticien',
        role: 'merchant',
        x: 2,
        y: 9,
        portrait: KNIGHT_ASSET,
        dialogue: 'Les combats ici sont longs. Prends des utilitaires, pas seulement des soins.',
      },
      {
        id: 'npc_sphinx',
        name: 'Myra la Sphinx',
        role: 'lore',
        x: 9,
        y: 3,
        portrait: WIZZARD_ASSET,
        dialogue: 'Je garde un passage interdit. Une seule tentative, pas plus.',
        riddlePool: [
          {
            id: 'riddle_sanctum_keys',
            question: 'J ai des villes mais pas de maisons, des forets mais pas d arbres. Qui suis-je ?',
            options: [
              { id: 'map', text: 'Une carte' },
              { id: 'book', text: 'Un livre' },
              { id: 'clock', text: 'Une horloge' },
            ],
            correctOptionId: 'map',
            successText: 'Myra trace un cercle. Un portail secret apparait dans le sanctuaire.',
            failText: 'La Sphinx refuse. Le passage reste ferme pour cette run.',
            reward: {
              gold: 95,
              materials: { ether_drop: 2 },
              revealSecretPortal: true,
            },
          },
          {
            id: 'riddle_sanctum_eyes',
            question: 'Je parle sans bouche et j entends sans oreilles. Qui suis-je ?',
            options: [
              { id: 'echo', text: 'Un echo' },
              { id: 'drum', text: 'Un tambour' },
              { id: 'blade', text: 'Une lame' },
            ],
            correctOptionId: 'echo',
            successText: 'Le sanctuaire repond a ta voix. Une faille cachee s ouvre.',
            failText: 'Myra detourne le regard. Plus aucune tentative aujourd hui.',
            reward: {
              gold: 90,
              materials: { boss_shard: 1 },
              revealSecretPortal: true,
            },
          },
        ],
      },
      {
        id: 'npc_etcher',
        name: 'Kail le Graveur',
        role: 'craft',
        x: 4,
        y: 4,
        portrait: ROGUE_ASSET,
        dialogue: 'Je grave des runes sur les armes epiques et legendaires.',
      },
    ],
    resources: [
      { id: 'sanctum_ore_1', type: 'ore', x: 3, y: 3, charges: 3 },
      { id: 'sanctum_ore_2', type: 'ore', x: 12, y: 7, charges: 3 },
      { id: 'sanctum_herb_1', type: 'herb', x: 6, y: 8, charges: 3 },
      { id: 'sanctum_tree_1', type: 'tree', x: 10, y: 4, charges: 2 },
    ],
    chests: [
      { id: 'chest_sanctum_1', x: 7, y: 5, rarityBias: 'legendary' },
      { id: 'chest_sanctum_2', x: 13, y: 9, rarityBias: 'epic' },
    ],
    enemies: [
      { id: 'e_sanctum_1', templateId: 'obsidian_reaper', x: 5, y: 6 },
      { id: 'e_sanctum_2', templateId: 'whisper_thief', x: 9, y: 6 },
      { id: 'e_sanctum_3', templateId: 'bone_guard', x: 11, y: 4 },
      { id: 'e_sanctum_4', templateId: 'crypt_mage', x: 4, y: 8 },
      { id: 'e_sanctum_5', templateId: 'obsidian_reaper', x: 12, y: 3 },
    ],
    boss: { id: 'boss_sanctum', templateId: 'boss_forge_titan', x: 13, y: 2 },
    tiles: [
      '################',
      '#......#.......#',
      '#.####.#.###.#.#',
      '#.#....#...#.#.#',
      '#.#.######.#.#.#',
      '#.#......#.#...#',
      '#.######.#.###.#',
      '#......#.#.....#',
      '#.####.#.#####.#',
      '#....#.#.......#',
      '#..............#',
      '################',
    ],
  },

  abyssal_archive: {
    id: 'abyssal_archive',
    name: 'Archive Abyssale',
    levelRange: '10-12',
    isSecret: false,
    background: '/assets/Environment/Tilesets/Dungeon_Tiles.png',
    width: 16,
    height: 12,
    start: { x: 1, y: 1 },
    exit: { x: 14, y: 10, targetMapId: 'ember_crossroads' },
    secretPortal: null,
    backPortal: {
      x: 1,
      y: 10,
      targetMapId: 'shattered_sanctum',
    },
    npcs: [
      {
        id: 'npc_archivist',
        name: 'Seline l Archiviste',
        role: 'merchant',
        x: 2,
        y: 2,
        portrait: WIZZARD_ASSET,
        dialogue: 'Je troque des potions tactiques contre de l or. Elles sauvent des runs.',
      },
      {
        id: 'npc_warder',
        name: 'Vark le Gardien',
        role: 'healer',
        x: 10,
        y: 2,
        portrait: KNIGHT_ASSET,
        dialogue: 'Soins complets et benediction. Tu vas en avoir besoin.',
      },
      {
        id: 'npc_respec_scholar',
        name: 'Orim le Delieur',
        role: 'respec',
        x: 7,
        y: 2,
        portrait: KNIGHT_ASSET,
        dialogue: 'Je peux reinitialiser ton arbre passif une seule fois: 200 or, pas de second essai.',
      },
    ],
    resources: [
      { id: 'archive_ore_1', type: 'ore', x: 4, y: 4, charges: 3 },
      { id: 'archive_ore_2', type: 'ore', x: 11, y: 8, charges: 3 },
      { id: 'archive_herb_1', type: 'herb', x: 6, y: 6, charges: 3 },
      { id: 'archive_tree_1', type: 'tree', x: 13, y: 3, charges: 2 },
    ],
    chests: [
      { id: 'chest_archive_1', x: 8, y: 8, rarityBias: 'mythic' },
      { id: 'chest_archive_2', x: 3, y: 7, rarityBias: 'legendary' },
    ],
    enemies: [
      { id: 'e_archive_1', templateId: 'obsidian_reaper', x: 5, y: 5 },
      { id: 'e_archive_2', templateId: 'whisper_thief', x: 7, y: 6 },
      { id: 'e_archive_3', templateId: 'crypt_mage', x: 10, y: 5 },
      { id: 'e_archive_4', templateId: 'bone_guard', x: 12, y: 7 },
      { id: 'e_archive_5', templateId: 'obsidian_reaper', x: 9, y: 3 },
    ],
    boss: { id: 'boss_archive', templateId: 'boss_obsidian_archon', x: 14, y: 2 },
    tiles: [
      '################',
      '#..............#',
      '#.#####.######.#',
      '#.#...#....#...#',
      '#.#.#.####.#.###',
      '#...#....#.#...#',
      '###.####.#.###.#',
      '#...#..#.#.....#',
      '#.###..#.#####.#',
      '#.....##.......#',
      '#..............#',
      '################',
    ],
  },

  ember_crossroads: {
    id: 'ember_crossroads',
    name: 'Carrefour des Braises',
    levelRange: '11-13',
    isSecret: false,
    background: '/assets/Environment/Tilesets/Floors_Tiles.png',
    width: 16,
    height: 12,
    start: { x: 1, y: 1 },
    exit: { x: 14, y: 10, targetMapId: 'veil_harbor' },
    secretPortal: null,
    backPortal: {
      x: 1,
      y: 10,
      targetMapId: 'abyssal_archive',
    },
    npcs: [
      {
        id: 'npc_crossroads_merchant',
        name: 'Ryn le Convoyeur',
        role: 'merchant',
        x: 2,
        y: 2,
        portrait: ROGUE_ASSET,
        dialogue: 'Entre deux royaumes, je vends ce qui sauve la peau.',
      },
      {
        id: 'npc_crossroads_smith',
        name: 'Torga la Forgeuse',
        role: 'craft',
        x: 12,
        y: 2,
        portrait: KNIGHT_ASSET,
        dialogue: 'Si tu as les materiaux, je te rends pret pour la suite.',
      },
    ],
    resources: [
      { id: 'cross_tree_1', type: 'tree', x: 4, y: 3, charges: 3 },
      { id: 'cross_ore_1', type: 'ore', x: 11, y: 4, charges: 3 },
      { id: 'cross_herb_1', type: 'herb', x: 8, y: 8, charges: 3 },
      { id: 'cross_ore_2', type: 'ore', x: 13, y: 7, charges: 2 },
    ],
    chests: [
      { id: 'chest_cross_1', x: 3, y: 8, rarityBias: 'epic' },
      { id: 'chest_cross_2', x: 10, y: 9, rarityBias: 'legendary' },
    ],
    enemies: [
      { id: 'e_cross_1', templateId: 'bone_guard', x: 5, y: 6 },
      { id: 'e_cross_2', templateId: 'obsidian_reaper', x: 9, y: 6 },
      { id: 'e_cross_3', templateId: 'crypt_mage', x: 12, y: 5 },
      { id: 'e_cross_4', templateId: 'whisper_thief', x: 7, y: 3 },
      { id: 'e_cross_5', templateId: 'obsidian_reaper', x: 13, y: 9 },
    ],
    boss: { id: 'boss_crossroads', templateId: 'boss_forge_titan', x: 14, y: 2 },
    tiles: [
      '################',
      '#..............#',
      '#..####...###..#',
      '#......#.......#',
      '#.####.#.#####.#',
      '#.#....#.....#.#',
      '#.#.######.#.#.#',
      '#...#....#.#...#',
      '###.#.##.#.###.#',
      '#...#....#.....#',
      '#..............#',
      '################',
    ],
  },

  veil_harbor: {
    id: 'veil_harbor',
    name: 'Havre du Voile',
    levelRange: '12-14',
    isSecret: false,
    background: '/assets/Environment/Tilesets/Water_tiles.png',
    width: 16,
    height: 12,
    start: { x: 1, y: 10 },
    exit: { x: 14, y: 1, targetMapId: 'ending' },
    secretPortal: null,
    backPortal: {
      x: 1,
      y: 1,
      targetMapId: 'ember_crossroads',
    },
    npcs: [
      {
        id: 'npc_harbor_healer',
        name: 'Naya des Marees',
        role: 'healer',
        x: 2,
        y: 9,
        portrait: WIZZARD_ASSET,
        dialogue: 'Le dernier trajet est rude. Repare tes forces avant de partir.',
      },
      {
        id: 'npc_harbor_lore',
        name: 'Eldran le Veilleur',
        role: 'lore',
        x: 11,
        y: 2,
        portrait: KNIGHT_ASSET,
        dialogue: 'Le coeur du Voile n est plus loin. Chaque pas compte.',
        riddlePool: [
          {
            id: 'riddle_harbor_1',
            question: 'Je prends des pages sans lire, des lettres sans ecrire, et je porte des villes sans marcher. Qui suis-je ?',
            options: [
              { id: 'atlas', text: 'Un atlas' },
              { id: 'scribe', text: 'Un scribe' },
              { id: 'banner', text: 'Une banniere' },
            ],
            correctOptionId: 'atlas',
            successText: 'Eldran incline la tete. Ton raisonnement perce les brumes.',
            failText: 'Eldran ferme son grimoire. Rien ne bouge.',
            reward: { gold: 95, materials: { ether_drop: 2 } },
          },
          {
            id: 'riddle_harbor_2',
            question: 'Plus je suis vrai, moins on me croit. Plus je mens, plus on me suit. Qui suis-je ?',
            options: [
              { id: 'rumor', text: 'Une rumeur' },
              { id: 'judge', text: 'Un juge' },
              { id: 'mirror', text: 'Un miroir' },
            ],
            correctOptionId: 'rumor',
            successText: 'Le Veilleur sourit: ta logique tient.',
            failText: 'Le silence repond a ta place.',
            reward: { gold: 90, materials: { resin: 3 } },
          },
          {
            id: 'riddle_harbor_3',
            question: 'Je naquis quand tu me nommes, je meurs quand tu me comprends. Qui suis-je ?',
            options: [
              { id: 'mystery', text: 'Une enigme' },
              { id: 'promise', text: 'Une promesse' },
              { id: 'fear', text: 'La peur' },
            ],
            correctOptionId: 'mystery',
            successText: 'Une rune se grave sur ta route.',
            failText: 'Les runes se figent. Aucun effet.',
            reward: { gold: 96, materials: { boss_shard: 1 } },
          },
          {
            id: 'riddle_harbor_4',
            question: 'Je suis plus lourd qu un souvenir, plus leger qu un serment, et pourtant je fais tomber des royaumes. Qui suis-je ?',
            options: [
              { id: 'word', text: 'Un mot' },
              { id: 'stone', text: 'Une pierre' },
              { id: 'coin', text: 'Une piece' },
            ],
            correctOptionId: 'word',
            successText: 'Le Veilleur ouvre une nouvelle ligne dans ses archives.',
            failText: 'Le parchemin reste clos.',
            reward: { gold: 88, materials: { herb: 3 } },
          },
          {
            id: 'riddle_harbor_5',
            question: 'Je cours en cercle sans jamais tourner, je monte sans grimper, et j acheve ce que je cree. Qui suis-je ?',
            options: [
              { id: 'time', text: 'Le temps' },
              { id: 'river', text: 'Une riviere' },
              { id: 'forge', text: 'Une forge' },
            ],
            correctOptionId: 'time',
            successText: 'Eldran valide ton intuition.',
            failText: 'Erreur. Le monde continue sans te repondre.',
            reward: { gold: 92, materials: { ore: 3 } },
          },
          {
            id: 'riddle_harbor_6',
            question: 'Je peux etre plein et vide a la fois. Je n existe que par mes limites. Qui suis-je ?',
            options: [
              { id: 'set', text: 'Un ensemble' },
              { id: 'box', text: 'Une boite' },
              { id: 'cloud', text: 'Un nuage' },
            ],
            correctOptionId: 'set',
            successText: 'La logique du Voile te reconnait.',
            failText: 'Aucune reaction dans la salle.',
            reward: { gold: 93, materials: { obsidian_fragment: 2 } },
          },
          {
            id: 'riddle_harbor_7',
            question: 'Je suis vu par tous, compris par peu, et inverse tout sans bouger. Qui suis-je ?',
            options: [
              { id: 'mirror', text: 'Un miroir' },
              { id: 'storm', text: 'Une tempete' },
              { id: 'king', text: 'Un roi' },
            ],
            correctOptionId: 'mirror',
            successText: 'Un eclat bleu pulse un instant.',
            failText: 'Le reflet s eteint.',
            reward: { gold: 97, materials: { ether_drop: 2 } },
          },
          {
            id: 'riddle_harbor_8',
            question: 'Je n ai ni debut ni fin, mais je tranche tout ce qui me traverse. Qui suis-je ?',
            options: [
              { id: 'line', text: 'Une ligne' },
              { id: 'blade', text: 'Une lame' },
              { id: 'wind', text: 'Le vent' },
            ],
            correctOptionId: 'line',
            successText: 'La carte se complete d un trait net.',
            failText: 'Le trait disparait aussitot.',
            reward: { gold: 91, materials: { wood: 3 } },
          },
          {
            id: 'riddle_harbor_9',
            question: 'Je suis toujours demain dans la bouche des faibles et toujours aujourd hui dans la main des forts. Qui suis-je ?',
            options: [
              { id: 'action', text: 'L action' },
              { id: 'luck', text: 'La chance' },
              { id: 'sleep', text: 'Le sommeil' },
            ],
            correctOptionId: 'action',
            successText: 'Eldran approuve: tu avances sans attendre.',
            failText: 'Le Veilleur ne dit rien. Rien ne se passe.',
            reward: { gold: 94, materials: { resin: 2, herb: 2 } },
          },
          {
            id: 'riddle_harbor_10',
            question: 'Je suis la seule cle qui n ouvre aucune porte mais ferme toutes les erreurs. Qui suis-je ?',
            options: [
              { id: 'proof', text: 'La preuve' },
              { id: 'lock', text: 'Un verrou' },
              { id: 'torch', text: 'Une torche' },
            ],
            correctOptionId: 'proof',
            successText: 'Le dernier sceau du Veilleur cede.',
            failText: 'La salle reste immobile.',
            reward: { gold: 100, materials: { boss_shard: 1, ether_drop: 1 } },
          },
        ],
      },
    ],
    resources: [
      { id: 'harbor_ore_1', type: 'ore', x: 4, y: 8, charges: 3 },
      { id: 'harbor_tree_1', type: 'tree', x: 8, y: 9, charges: 3 },
      { id: 'harbor_herb_1', type: 'herb', x: 12, y: 8, charges: 3 },
      { id: 'harbor_herb_2', type: 'herb', x: 6, y: 4, charges: 2 },
    ],
    chests: [
      { id: 'chest_harbor_1', x: 6, y: 7, rarityBias: 'legendary' },
      { id: 'chest_harbor_2', x: 13, y: 3, rarityBias: 'mythic' },
    ],
    enemies: [
      { id: 'e_harbor_1', templateId: 'obsidian_reaper', x: 5, y: 6 },
      { id: 'e_harbor_2', templateId: 'whisper_thief', x: 7, y: 6 },
      { id: 'e_harbor_3', templateId: 'crypt_mage', x: 10, y: 5 },
      { id: 'e_harbor_4', templateId: 'bone_guard', x: 12, y: 6 },
      { id: 'e_harbor_5', templateId: 'obsidian_reaper', x: 13, y: 8 },
    ],
    boss: { id: 'boss_harbor', templateId: 'boss_obsidian_archon', x: 14, y: 9 },
    tiles: [
      '################',
      '#..............#',
      '#.####....####.#',
      '#....#....#....#',
      '#.##.######.##.#',
      '#..............#',
      '#.######..####.#',
      '#......#..#....#',
      '#.####.#..#.##.#',
      '#..............#',
      '#..............#',
      '################',
    ],
  },

  lunar_shrine: {
    id: 'lunar_shrine',
    name: 'Sanctuaire Lunaire (Secret)',
    levelRange: '7-9',
    isSecret: true,
    background: '/assets/Environment/Tilesets/Water_tiles.png',
    width: 16,
    height: 12,
    start: { x: 1, y: 1 },
    exit: { x: 14, y: 10, targetMapId: 'return' },
    secretPortal: null,
    backPortal: null,
    npcs: [
      {
        id: 'npc_oracle',
        name: 'Oracle des lacs',
        role: 'healer',
        x: 3,
        y: 2,
        portrait: WIZZARD_ASSET,
        dialogue: 'Tu as trouvé une zone secrete. Ici, chaque erreur coûte cher.',
      },
    ],
    resources: [
      { id: 'lunar_ore_1', type: 'ore', x: 11, y: 2, charges: 4 },
      { id: 'lunar_herb_1', type: 'herb', x: 6, y: 9, charges: 4 },
      { id: 'lunar_tree_1', type: 'tree', x: 13, y: 8, charges: 3 },
    ],
    chests: [{ id: 'chest_lunar_1', x: 4, y: 8, rarityBias: 'legendary' },
             { id: 'chest_lunar_1', x: 8, y: 4, rarityBias: 'legendary' }
    ],
    enemies: [
      { id: 'e_lunar_1', templateId: 'obsidian_reaper', x: 9, y: 3 },
      { id: 'e_lunar_2', templateId: 'whisper_thief', x: 10, y: 6 },
      { id: 'e_lunar_3', templateId: 'crypt_mage', x: 5, y: 6 },
    ],
    boss: { id: 'boss_mirror', templateId: 'boss_mirror_eater', x: 12, y: 9 },
    tiles: [
      '################',
      '#..............#',
      '#..~~~~..~~~~..#',
      '#..............#',
      '#.####....####.#',
      '#..............#',
      '#..~~~~..~~~~..#',
      '#..............#',
      '#.####....####.#',
      '#..............#',
      '#..............#',
      '################',
    ],
  },

  forgotten_foundry: {
    id: 'forgotten_foundry',
    name: 'Fonderie Oubliee (Secret)',
    levelRange: '8-10',
    isSecret: true,
    background: '/assets/Environment/Tilesets/Wall_Variations.png',
    width: 16,
    height: 12,
    start: { x: 1, y: 10 },
    exit: { x: 14, y: 1, targetMapId: 'return' },
    secretPortal: null,
    backPortal: null,
    noSpawnZones: [{ x: 6, y: 5, width: 4, height: 3 }],
    npcs: [
      {
        id: 'npc_forge_ghost',
        name: 'Spectre du Four',
        role: 'craft',
        x: 2,
        y: 9,
        portrait: KNIGHT_ASSET,
        dialogue: 'Je n accepte que des minerais rares. En echange, je te rends plus fort.',
      },
    ],
    resources: [
      { id: 'forge_ore_1', type: 'ore', x: 4, y: 8, charges: 4 },
      { id: 'forge_ore_2', type: 'ore', x: 11, y: 5, charges: 4 },
      { id: 'forge_tree_1', type: 'tree', x: 8, y: 9, charges: 3 },
    ],
    chests: [
      { id: 'chest_forge_1', x: 6, y: 9, rarityBias: 'legendary' },
      { id: 'chest_forge_2', x: 12, y: 2, rarityBias: 'epic' },
    ],
    enemies: [
      { id: 'e_forge_1', templateId: 'bone_guard', x: 5, y: 7 },
      { id: 'e_forge_2', templateId: 'obsidian_reaper', x: 9, y: 6 },
      { id: 'e_forge_3', templateId: 'whisper_thief', x: 12, y: 4 },
      { id: 'e_forge_4', templateId: 'crypt_mage', x: 7, y: 4 },
    ],
    boss: { id: 'boss_forge', templateId: 'boss_forge_titan', x: 13, y: 8 },
    tiles: [
      '################',
      '#..............#',
      '#..##....##....#',
      '#..............#',
      '#....##..##....#',
      '#..............#',
      '#..###....###..#',
      '#..............#',
      '#....######....#',
      '#..............#',
      '#..##....##....#',
      '#..............#',
      '################',
    ],
  },

  echoing_vault: {
    id: 'echoing_vault',
    name: 'Voute des Echos (Secret)',
    levelRange: '9-11',
    isSecret: true,
    background: '/assets/Environment/Tilesets/Water_tiles.png',
    width: 16,
    height: 12,
    start: { x: 1, y: 1 },
    exit: { x: 14, y: 10, targetMapId: 'return' },
    secretPortal: null,
    backPortal: null,
    npcs: [
      {
        id: 'npc_vault_keeper',
        name: 'Eris la Gardienne',
        role: 'healer',
        x: 2,
        y: 2,
        portrait: ROGUE_ASSET,
        dialogue: 'Bienvenue dans la voute. Ici, les reliques tombent mais les ennemis frappent vite.',
      },
    ],
    resources: [
      { id: 'vault_ore_1', type: 'ore', x: 11, y: 3, charges: 4 },
      { id: 'vault_ore_2', type: 'ore', x: 9, y: 8, charges: 4 },
      { id: 'vault_herb_1', type: 'herb', x: 6, y: 5, charges: 3 },
      { id: 'vault_tree_1', type: 'tree', x: 13, y: 8, charges: 3 },
    ],
    chests: [
      { id: 'chest_vault_1', x: 4, y: 8, rarityBias: 'mythic' },
      { id: 'chest_vault_2', x: 12, y: 2, rarityBias: 'legendary' },
    ],
    enemies: [
      { id: 'e_vault_1', templateId: 'obsidian_reaper', x: 5, y: 6 },
      { id: 'e_vault_2', templateId: 'whisper_thief', x: 9, y: 6 },
      { id: 'e_vault_3', templateId: 'crypt_mage', x: 10, y: 4 },
      { id: 'e_vault_4', templateId: 'bone_guard', x: 12, y: 7 },
    ],
    boss: { id: 'boss_vault', templateId: 'boss_mirror_eater', x: 13, y: 9 },
    tiles: [
      '################',
      '#..............#',
      '#..~~~~..~~~~..#',
      '#..............#',
      '#.####..##.###.#',
      '#..............#',
      '#..~~~~..~~~~..#',
      '#..............#',
      '#.###.####.###.#',
      '#..............#',
      '#..............#',
      '################',
    ],
  },
}

export const MAP_ORDER = [
  'ashen_meadow',
  'whispering_catacombs',
  'obsidian_citadel',
  'shattered_sanctum',
  'abyssal_archive',
  'ember_crossroads',
  'veil_harbor',
]

export function getMapById(mapId) {
  return MAPS[mapId] ?? null
}

export function mapIsWalkable(map, x, y, tilesOverride = null) {
  if (!map) {
    return false
  }
  if (x < 0 || y < 0 || x >= map.width || y >= map.height) {
    return false
  }
  const tiles = tilesOverride ?? map.tiles
  return tiles?.[y]?.[x] === '.'
}
